<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Noise Generator</title>

    <style>
        /* Active preset button highlight */
        .preset-buttons button.active {
            border-color: #55a8f0;
            background-color: #2266aa;
            color: #fff;
        }
        body.light-mode .preset-buttons button.active {
            border-color: #ffd966;
            background-color: #ffe699;
            color: #222;
        }
        /* Light mode styles */
        body.light-mode {
            background-color: #f5f5f5;
            color: #222;
        }
        body.light-mode .container {
            background-color: #fff;
            color: #222;
            box-shadow: 0 10px 20px rgba(0,0,0,0.08);
        }
        body.light-mode .preset-buttons button {
            background-color: #eaeaea;
            color: #222;
            border-color: #ccc;
        }
        body.light-mode .preset-buttons button:hover {
            background-color: #d5eaff;
        }
        body.light-mode .play-button {
            background-color: #ffd966;
            color: #222;
            box-shadow: 0 5px 15px rgba(255,217,102,0.2);
        }
        body.light-mode .play-button:hover {
            background-color: #ffe699;
        }
        body.light-mode .slider-container label {
            color: #555;
        }
        body.light-mode .technical-details {
            background-color: #f3f3f3;
            color: #222;
        }
        body.light-mode .technical-details-content p {
            color: #444;
        }
        body.light-mode input[type="range"] {
            background: #ddd;
        }
        body.light-mode input[type="range"]::-webkit-slider-thumb {
            background: #ffd966;
            border: 3px solid #fff;
        }
        body.light-mode input[type="range"]::-moz-range-thumb {
            background: #ffd966;
            border: 3px solid #fff;
        }
        body.light-mode .volume-container svg {
            fill: #888;
        }
        body.light-mode #waveform {
            background: #fff;
        }
        /* General styling for the body */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #1a1a1a;
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            text-align: center;
            box-sizing: border-box; /* Ensures padding doesn't affect overall size */
        }

        /* Main container for the app */
        .container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            background-color: #2c2c2c;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            transition: transform 0.3s ease-in-out;
            box-sizing: border-box;
        }

        /* Title styling */
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        /* Preset buttons container */
        .preset-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 2rem;
        }
        
        /* Preset button styling */
        .preset-buttons button {
            background-color: #3a3a3a;
            color: #ffffff;
            border: 2px solid #5a5a5a;
            border-radius: 10px;
            padding: 10px 15px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .preset-buttons button:hover {
            background-color: #4a4a4a;
        }

        /* Play/pause button styling */
        .play-button {
            background-color: #55a8f0;
            color: #ffffff;
            border: none;
            border-radius: 50%;
            width: 120px;
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(85, 168, 240, 0.4);
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-bottom: 2rem;
            position: relative;
        }

        .play-button:hover {
            background-color: #4a95d6;
            transform: scale(1.05);
        }

        .play-button:active {
            transform: scale(0.98);
        }

        .play-button svg {
            width: 50px;
            height: 50px;
            fill: currentColor;
            transition: transform 0.2s ease;
        }

        /* Specific icon states for play and pause */
        .play-button.playing .play-icon,
        .play-button:not(.playing) .pause-icon {
            display: none;
        }

        .play-button.playing .pause-icon {
            display: block;
        }

        .play-button:not(.playing) .play-icon {
            display: block;
        }

        /* Slider container styles */
        .slider-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            margin-bottom: 1.5rem;
        }
        
        /* Tooltip-like behavior on labels */
        .slider-container label {
            text-align: left;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #aaa;
        }

        .slider-container label[title] {
            cursor: help;
        }

        /* Volume control styling */
        .volume-container {
            display: flex;
            align-items: center;
            width: 100%;
        }

        .volume-container svg {
            width: 24px;
            height: 24px;
            fill: #aaa;
            margin-right: 10px;
        }

        /* Slider track styling */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: #444;
            border-radius: 5px;
            outline: none;
            cursor: pointer;
        }

        /* Slider thumb styling */
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #55a8f0;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid #1a1a1a;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #55a8f0;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid #1a1a1a;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }

        /* Technical details section styling */
        .technical-details {
            width: 100%;
            margin-top: 1.5rem;
            background-color: #3a3a3a;
            border-radius: 10px;
            padding: 15px;
            text-align: left;
            transition: all 0.3s ease;
        }
        
        .technical-details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .technical-details-header h2 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .technical-details-header .toggle-icon {
            font-size: 1.5rem;
            transition: transform 0.3s ease;
        }

        .technical-details-header.open .toggle-icon {
            transform: rotate(180deg);
        }

        .technical-details-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
            padding-top: 0;
        }

        .technical-details-content.show {
            max-height: 500px; /* A large enough value to accommodate the content */
            padding-top: 15px;
        }

        .technical-details-content p {
            margin: 0 0 10px 0;
            line-height: 1.5;
            color: #c0c0c0;
            font-size: 0.9rem;
        }
        
        .technical-details-content strong {
            color: #ffffff;
        }

    </style>
</head>
<body>

<div class="container" id="main-container">
    <h1>Custom Noise</h1>

    <!-- Dark/Light mode toggle -->
    <button id="theme-toggle" aria-label="Toggle dark/light mode" style="margin-bottom:1rem;">üåô/‚òÄÔ∏è</button>

    <!-- Preset buttons -->
    <div class="preset-buttons">
        <button id="white-preset" aria-label="White noise preset">White</button>
        <button id="pink-preset" aria-label="Pink noise preset">Pink</button>
        <button id="brown-preset" aria-label="Brown noise preset">Brown</button>
        <button id="violet-preset" aria-label="Violet noise preset">Violet</button>
        <button id="reset-preset" aria-label="Reset sliders">Reset</button>
    </div>

    <!-- Play/Pause button with SVG icons -->
    <button id="play-button" class="play-button" aria-label="Play or pause noise">
        <svg class="play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        <svg class="pause-icon" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
    </button>

    <!-- Waveform animation -->
    <canvas id="waveform" width="320" height="60" style="width:100%;max-width:320px;margin-bottom:1rem;display:none;"></canvas>

    <!-- Low-Pass Filter Slider -->
    <div class="slider-container">
        <label for="low-pass-slider" title="A low-pass filter blocks high frequencies. Moving the slider down cuts more hiss, making the sound feel deeper." aria-label="High Frequencies (Hiss)">High Frequencies (Hiss)
            <span id="lowPassValue" style="float:right;font-weight:bold;">20000 Hz</span>
        </label>
        <input type="range" id="low-pass-slider" min="100" max="20000" step="1" value="20000" aria-valuemin="100" aria-valuemax="20000" aria-valuenow="20000" aria-label="High Frequencies slider">
    </div>

    <!-- High-Pass Filter Slider -->
    <div class="slider-container">
        <label for="high-pass-slider" title="A high-pass filter blocks low frequencies. Moving the slider up cuts more rumble, making the sound feel sharper." aria-label="Low Frequencies (Rumble)">Low Frequencies (Rumble)
            <span id="highPassValue" style="float:right;font-weight:bold;">0 Hz</span>
        </label>
        <input type="range" id="high-pass-slider" min="0" max="5000" step="1" value="0" aria-valuemin="0" aria-valuemax="5000" aria-valuenow="0" aria-label="Low Frequencies slider">
    </div>

    <!-- Volume slider -->
    <div class="volume-container">
        <svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.81 5 3.54 5 6.71s-2.11 5.9-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
        <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0.5" aria-label="Volume slider">
        <span id="volumeValue" style="margin-left:10px;font-weight:bold;">0.50</span>
    </div>

    <!-- Technical details section -->
    <div class="technical-details">
        <div class="technical-details-header" id="details-header">
            <h2>Technical Details</h2>
            <span class="toggle-icon">&#9660;</span>
        </div>
        <div class="technical-details-content" id="details-content">
            <p>This generator creates <strong>white, pink, brown, and violet noise</strong> using real-time algorithms. White noise contains all audible frequencies at equal intensity. Pink and brown noise are filtered to emphasize lower frequencies, while violet noise emphasizes higher frequencies.</p>
            <p><strong>Presets</strong> set the filters and noise type for common noise colors. You can also customize the sliders for a unique blend.</p>
            <p><strong>Tip:</strong> You can save your favorite settings by bookmarking the page after adjusting the sliders.</p>
        </div>
    </div>
</div>

<script>
    // Group DOM elements
    const els = {
        play: document.getElementById('play-button'),
        volume: document.getElementById('volume-slider'),
        lowPass: document.getElementById('low-pass-slider'),
        highPass: document.getElementById('high-pass-slider'),
        presets: [
            {btn: document.getElementById('white-preset'), type: 'white', lp: 20000, hp: 0},
            {btn: document.getElementById('pink-preset'), type: 'pink', lp: 1000, hp: 0},
            {btn: document.getElementById('brown-preset'), type: 'brown', lp: 300, hp: 0},
            {btn: document.getElementById('violet-preset'), type: 'violet', lp: 20000, hp: 4000},
        ],
        reset: document.getElementById('reset-preset'),
        theme: document.getElementById('theme-toggle'),
        lowPassValue: document.getElementById('lowPassValue'),
        highPassValue: document.getElementById('highPassValue'),
        volumeValue: document.getElementById('volumeValue'),
        waveform: document.getElementById('waveform'),
        detailsHeader: document.getElementById('details-header'),
        detailsContent: document.getElementById('details-content'),
        main: document.getElementById('main-container')
    };

    // Audio context and nodes
    let audioContext, noiseNode, lowPassFilter, highPassFilter, gainNode;
    let isPlaying = false, workletLoaded = false, noiseType = 'white', animationFrame;

    // Noise generator
    async function createNoiseNode(ctx, type) {
        if (!workletLoaded) {
            const code = `
                class WhiteNoiseProcessor extends AudioWorkletProcessor {
                    process(inputs, outputs, parameters) {
                        const output = outputs[0];
                        for (let channel = 0; channel < output.length; ++channel) {
                            const outputChannel = output[channel];
                            for (let i = 0; i < outputChannel.length; ++i) {
                                outputChannel[i] = Math.random() * 2 - 1;
                            }
                        }
                        return true;
                    }
                }
                registerProcessor('white-noise-processor', WhiteNoiseProcessor);

                class PinkNoiseProcessor extends AudioWorkletProcessor {
                    constructor() {
                        super();
                        this.b0 = this.b1 = this.b2 = this.b3 = this.b4 = this.b5 = this.b6 = 0;
                    }
                    process(inputs, outputs, parameters) {
                        const output = outputs[0];
                        for (let channel = 0; channel < output.length; ++channel) {
                            const outputChannel = output[channel];
                            for (let i = 0; i < outputChannel.length; ++i) {
                                let white = Math.random() * 2 - 1;
                                this.b0 = 0.99886 * this.b0 + white * 0.0555179;
                                this.b1 = 0.99332 * this.b1 + white * 0.0750759;
                                this.b2 = 0.96900 * this.b2 + white * 0.1538520;
                                this.b3 = 0.86650 * this.b3 + white * 0.3104856;
                                this.b4 = 0.55000 * this.b4 + white * 0.5329522;
                                this.b5 = -0.7616 * this.b5 - white * 0.0168980;
                                outputChannel[i] = this.b0 + this.b1 + this.b2 + this.b3 + this.b4 + this.b5 + this.b6 + white * 0.5362;
                                outputChannel[i] *= 0.11;
                                this.b6 = white * 0.115926;
                            }
                        }
                        return true;
                    }
                }
                registerProcessor('pink-noise-processor', PinkNoiseProcessor);

                class BrownNoiseProcessor extends AudioWorkletProcessor {
                    constructor() {
                        super();
                        this.lastOut = 0;
                    }
                    process(inputs, outputs, parameters) {
                        const output = outputs[0];
                        for (let channel = 0; channel < output.length; ++channel) {
                            const outputChannel = output[channel];
                            for (let i = 0; i < outputChannel.length; ++i) {
                                let white = Math.random() * 2 - 1;
                                this.lastOut = (this.lastOut + (0.02 * white)) / 1.02;
                                outputChannel[i] = this.lastOut * 3.5;
                            }
                        }
                        return true;
                    }
                }
                registerProcessor('brown-noise-processor', BrownNoiseProcessor);

                class VioletNoiseProcessor extends AudioWorkletProcessor {
                    constructor() {
                        super();
                        this.lastWhite = 0;
                    }
                    process(inputs, outputs, parameters) {
                        const output = outputs[0];
                        for (let channel = 0; channel < output.length; ++channel) {
                            const outputChannel = output[channel];
                            for (let i = 0; i < outputChannel.length; ++i) {
                                let white = Math.random() * 2 - 1;
                                outputChannel[i] = white - this.lastWhite;
                                this.lastWhite = white;
                            }
                        }
                        return true;
                    }
                }
                registerProcessor('violet-noise-processor', VioletNoiseProcessor);
            `;
            await ctx.audioWorklet.addModule(URL.createObjectURL(new Blob([code], {type: 'application/javascript'})));
            workletLoaded = true;
        }
        return new AudioWorkletNode(ctx, `${type}-noise-processor`);
    }

    async function startPlaying() {
        stopPlaying();
        audioContext = audioContext && audioContext.state !== 'closed' ? audioContext : new (window.AudioContext || window.webkitAudioContext)();
        if (audioContext.state === 'suspended') await audioContext.resume();
        noiseNode = await createNoiseNode(audioContext, noiseType);
        lowPassFilter = audioContext.createBiquadFilter();
        highPassFilter = audioContext.createBiquadFilter();
        gainNode = audioContext.createGain();
        lowPassFilter.type = 'lowpass';
        highPassFilter.type = 'highpass';
        noiseNode.connect(lowPassFilter).connect(highPassFilter).connect(gainNode).connect(audioContext.destination);
        gainNode.gain.value = els.volume.value;
        lowPassFilter.frequency.value = els.lowPass.value;
        highPassFilter.frequency.value = els.highPass.value;
        isPlaying = true;
        els.play.classList.add('playing');
        els.waveform.style.display = 'block';
        drawWaveform();
    }
    
    // Removed: createAndPlay (logic now in startPlaying)

    function stopPlaying() {
        [noiseNode, lowPassFilter, highPassFilter, gainNode].forEach(node => node && node.disconnect());
        [noiseNode, lowPassFilter, highPassFilter, gainNode] = [null, null, null, null];
        isPlaying = false;
        els.play.classList.remove('playing');
        els.waveform.style.display = 'none';
        cancelAnimationFrame(animationFrame);
    }
    
    function applyPreset(type, lp, hp) {
        noiseType = type;
        els.lowPass.value = lp;
        els.highPass.value = hp;
        updateUI();
        if (lowPassFilter) lowPassFilter.frequency.setTargetAtTime(lp, audioContext.currentTime, 0.05);
        if (highPassFilter) highPassFilter.frequency.setTargetAtTime(hp, audioContext.currentTime, 0.05);
        if (isPlaying) { stopPlaying(); startPlaying(); }
        saveSettings();
    }

    els.play.addEventListener('click', () => isPlaying ? stopPlaying() : startPlaying());

    [els.lowPass, els.highPass].forEach(slider => slider.addEventListener('input', () => {
        updateUI();
        if (lowPassFilter) lowPassFilter.frequency.setTargetAtTime(els.lowPass.value, audioContext.currentTime, 0.05);
        if (highPassFilter) highPassFilter.frequency.setTargetAtTime(els.highPass.value, audioContext.currentTime, 0.05);
        saveSettings();
    }));

    els.volume.addEventListener('input', () => {
        updateUI();
        if (gainNode) gainNode.gain.setTargetAtTime(els.volume.value, audioContext.currentTime, 0.05);
        saveSettings();
    });

    els.presets.forEach(p => p.btn.addEventListener('click', () => applyPreset(p.type, p.lp, p.hp)));
    els.reset.addEventListener('click', () => applyPreset('white', 20000, 0));
    els.theme.addEventListener('click', () => {
        const isLight = document.body.classList.toggle('light-mode');
        els.theme.textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
        saveSettings();
    });
    if (document.body.classList.contains('light-mode')) {
        els.theme.textContent = '‚òÄÔ∏è';
    } else {
        els.theme.textContent = 'üåô';
    }

    document.querySelectorAll('button, input[type="range"]').forEach(el => el.setAttribute('tabindex', '0'));

    function updateUI() {
        els.lowPassValue.textContent = `${els.lowPass.value} Hz`;
        els.highPassValue.textContent = `${els.highPass.value} Hz`;
        els.volumeValue.textContent = Number(els.volume.value).toFixed(2);
        [els.lowPass, els.highPass, els.volume].forEach(slider => slider.setAttribute('aria-valuenow', slider.value));
        let matched = false;
        els.presets.forEach(p => {
            if (noiseType === p.type && Number(els.lowPass.value) === p.lp && Number(els.highPass.value) === p.hp) {
                p.btn.classList.add('active'); matched = true;
            } else p.btn.classList.remove('active');
        });
        els.reset.classList.toggle('active', !matched);
    }

    function saveSettings() {
        localStorage.setItem('noiseSettings', JSON.stringify({
            noiseType,
            lowPass: els.lowPass.value,
            highPass: els.highPass.value,
            volume: els.volume.value,
            theme: document.body.classList.contains('light-mode') ? 'light' : 'dark'
        }));
    }
    function loadSettings() {
        const s = localStorage.getItem('noiseSettings');
        if (s) {
            try {
                const {noiseType: nt, lowPass, highPass, volume, theme} = JSON.parse(s);
                noiseType = nt || 'white';
                els.lowPass.value = lowPass || 20000;
                els.highPass.value = highPass || 0;
                els.volume.value = volume || 0.5;
                if (theme === 'light') document.body.classList.add('light-mode');
            } catch(e) {}
        }
        updateUI();
    }

    function drawWaveform() {
        const ctx = els.waveform.getContext('2d');
        ctx.clearRect(0, 0, els.waveform.width, els.waveform.height);
        ctx.strokeStyle = '#55a8f0';
        ctx.lineWidth = 2;
        ctx.beginPath();
        let y = els.waveform.height / 2;
        ctx.moveTo(0, y);
        for (let i = 0; i < els.waveform.width; i++) {
            y = els.waveform.height / 2 + Math.sin((Date.now()/100 + i/8) % 360) * (els.waveform.height/3) * (isPlaying ? 1 : 0.2);
            ctx.lineTo(i, y);
        }
        ctx.stroke();
        animationFrame = requestAnimationFrame(drawWaveform);
    }

    // Initial load
    loadSettings();
    window.addEventListener('resize', () => {
        els.main.style.maxWidth = window.innerWidth < 500 ? '98vw' : '400px';
    });
    window.dispatchEvent(new Event('resize'));
    els.detailsHeader.addEventListener('click', () => {
        els.detailsContent.classList.toggle('show');
        els.detailsHeader.classList.toggle('open');
    });

</script>
</body>
</html>
